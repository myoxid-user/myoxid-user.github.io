<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#ffe6e6" />
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Vazirmatn:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            min-height: 100vh;
            min-height: 100dvh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            background-color: #ffe6e6;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Arial", sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        #hearts-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .floating-heart {
            position: fixed;
            bottom: -10%;
            pointer-events: none;
            opacity: 0;
            animation: floatUp linear infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 0.2;
            }

            50% {
                transform: translateY(-50vh) translateX(20px);
                opacity: 0.3;
            }

            90% {
                opacity: 0.1;
            }

            100% {
                transform: translateY(-110vh) translateX(-10px);
                opacity: 0;
            }
        }

        .rain-emoji {
            position: fixed;
            top: -50px;
            z-index: 9998;
            pointer-events: none;
            animation: fallDown linear forwards;
            font-size: 1.5rem;
        }

        @keyframes fallDown {
            to {
                transform: translateY(110vh) rotate(360deg);
            }
        }

        .container {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 40px 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            max-height: 100vh;
            max-height: 100dvh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            text-align: center;
            transition: transform 0.3s ease;
        }

        @media (min-width: 601px) {
            .container {
                max-width: 500px;
                width: 90%;
            }
        }

        .container h1 {
            font-family: "Pacifico", cursive;
            font-size: 2.2rem;
            color: #c0392b;
            margin-top: 0;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #e74c3c;
            margin-bottom: 25px;
            font-weight: 500;
            line-height: 1.5;
        }

        .hero-image {
            width: 100%;
            max-width: 320px;
            border-radius: 18px;
            box-shadow: 0 8px 24px rgba(231, 76, 60, 0.25);
            margin: 0 auto 25px;
            display: block;
            object-fit: cover;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            position: relative;
            min-height: 60px;
            flex-wrap: wrap;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .btn {
            font-size: 1.1rem;
            font-weight: bold;
            font-family: "Arial", sans-serif;
            padding: 14px 36px;
            min-height: 44px;
            min-width: 80px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            color: #ffffff;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            transition: left 0.4s ease-out, top 0.4s ease-out, background-color 0.2s;
            z-index: 9999;
            white-space: pre;
        }

        .yes-btn {
            background-color: #27ae60;
            box-shadow: 0 4px 0 #219150;
            transform: scale(var(--btn-scale, 1));
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.2s;
        }

        .yes-btn:hover {
            background-color: #2ecc71;
        }

        .yes-btn:active {
            box-shadow: 0 0 0 #219150;
        }

        @keyframes shakeBtn {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(var(--btn-scale, 1));
            }

            25% {
                transform: translate(-5px, 5px) rotate(-5deg) scale(var(--btn-scale, 1));
            }

            50% {
                transform: translate(5px, -5px) rotate(5deg) scale(var(--btn-scale, 1));
            }

            75% {
                transform: translate(-5px, 5px) rotate(-5deg) scale(var(--btn-scale, 1));
            }

            100% {
                transform: translate(0, 0) rotate(0deg) scale(var(--btn-scale, 1));
            }
        }

        .shake-active {
            animation: shakeBtn 0.4s ease-in-out;
        }

        .no-btn {
            background-color: #e74c3c;
            box-shadow: 0 4px 0 #c0392b;
        }

        .no-btn:hover {
            background-color: #ff6b6b;
        }

        .attempt-counter {
            font-size: 0.85rem;
            color: #999;
            margin-top: 15px;
            min-height: 1.2em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .attempt-counter.visible {
            opacity: 1;
        }

        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
            }

            70% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-image {
            max-width: 320px;
            width: 85%;
            border-radius: 18px;
            margin: 18px auto 0;
            box-shadow: 0 8px 24px rgba(231, 76, 60, 0.3);
            display: block;
            object-fit: cover;
        }

        .fade-slide-up {
            animation: fadeSlideUp 0.5s ease-out forwards;
        }

        @keyframes fadeSlideUp {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .cat-image {
            max-width: 300px;
            width: 80%;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            margin-bottom: 15px;
        }

        #cat-container h2 {
            font-family: "Georgia", serif;
            color: #e74c3c;
            margin-top: 10px;
            font-size: 1.4rem;
        }

        #cat-container p {
            color: #555;
            margin-bottom: 10px;
        }

        .cat-countdown-number {
            font-size: 3rem;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0 0;
            line-height: 1;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
                width: 92%;
            }

            .container h1 {
                font-size: 1.8rem;
            }

            .btn {
                padding: 12px 24px;
                font-size: 1rem;
            }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <audio id="bg-music" src="SailorSong.mp3" preload="auto"></audio>
    <div id="hearts-bg"></div>

    <div id="main-container" class="container">
        <h1>Will you be my valentine? &#x1F495;</h1>
        <p class="subtitle">
            Javab mosbatet be soal bala chie dordoonam? &#x1F60A;
        </p>
        <img class="hero-image" src="flower.jpg" alt="Romantic Moment"
            loading="lazy" />
        <div class="button-container">
            <button id="yes-btn" class="btn yes-btn">Yes! &#x1F496;</button>
            <button id="no-btn" class="btn no-btn">No &#x1F624;</button>
        </div>
        <p id="attempt-counter" class="attempt-counter"></p>
    </div>

    <div id="success-container" class="container" style="display: none">
        <h1 class="bounce-in">Yaaaay! &#x1F389;&#x2764;&#xFE0F;</h1>
        <p style="font-size: 1.2rem; font-weight: bold;">I knew it! Happy Valentine's Day! &#x1F618;</p>
        <img class="success-image" src="kiss.jpg" alt="Love" loading="lazy" />
    </div>

    <div id="cat-container" class="container fade-slide-up" style="display: none">
        <img id="cat-image" alt="Grumpy cat" class="cat-image" loading="lazy"
            onerror="this.style.display='none'; document.getElementById('cat-emoji').style.display='block';" />
        <div id="cat-emoji" style="display: none; font-size: 5rem; margin-bottom: 15px">&#x1F63E;</div>

        <div dir="rtl">
            <h2>AHA! Noob Sago Chera Mikhai Bezani Rooye No?</h2>
            <p>Merci Gozine 'No' Nadarim! Bezan Rooye YES &#x2764;</p>
        </div>

        <div class="button-container">
            <button id="cat-yes-btn" class="btn yes-btn">Yes! &#x1F496;</button>
        </div>

        <div id="cat-countdown" class="cat-countdown" style="display: none;">
            <p class="cat-countdown-text" dir="rtl" style="color:#e74c3c; font-weight:bold">Age ta 10 sanie dige
                nazani...</p>
            <p class="cat-countdown-text" dir="rtl">Sokot neshane rezas pas yani YES!</p>
            <p id="cat-countdown-number" class="cat-countdown-number">5</p>
        </div>
    </div>

    <script>
        (function () {
            const bgMusic = document.getElementById("bg-music");
            const START_AT_SECONDS = 60;
            let musicStarted = false;

            function startMusic() {
                if (!bgMusic || musicStarted) return;
                musicStarted = true;
                bgMusic.currentTime = START_AT_SECONDS;
                bgMusic.play().catch(() => { musicStarted = false; });
            }

            if (bgMusic) {
                bgMusic.addEventListener("canplaythrough", () => {
                    bgMusic.currentTime = START_AT_SECONDS;
                }, { once: true });
            }

            document.body.addEventListener("click", startMusic, { once: true });
            document.body.addEventListener("touchstart", startMusic, { once: true, passive: true });

            let noAttempts = 0;
            let noButtonEvading = false;
            let lastEvadeAtMs = 0;
            let currentYesScale = 1;
            let typingTimer = null;

            const noTexts = [
                "No üòí",
                "Fekr kon! ü§î",
                "Delam mishkane üíî",
                "Last Chance! ‚ö†Ô∏è",
                "Nemishe! ‚õî",
                "Be JaKelidit Negah KON! üò°"
            ];

            const rainEmojis = ["üíî", "üò¢", "‚õî", "No", "üò≠", "ü•Ä"];

            const heartsBg = document.getElementById("hearts-bg");
            const mainContainer = document.getElementById("main-container");
            const successContainer = document.getElementById("success-container");
            const catContainer = document.getElementById("cat-container");
            const yesBtn = document.getElementById("yes-btn");
            const noBtn = document.getElementById("no-btn");
            const attemptCounter = document.getElementById("attempt-counter");
            const catImage = document.getElementById("cat-image");
            const catYesBtn = document.getElementById("cat-yes-btn");
            const catCountdownEl = document.getElementById("cat-countdown");
            const catCountdownNumberEl = document.getElementById("cat-countdown-number");

            let catCountdownTimer = null;
            const CAT_TRIGGER_ATTEMPTS = 6;
            const CAT_COUNTDOWN_SECONDS = 10;
            const EVADE_COOLDOWN_MS = 200;
            const CAT_IMAGE_URL = "cat-image.png";

            const heartColors = ["#ff6b6b", "#ff8e8e", "#ffb4b4", "#e74c3c"];
            function createHearts() {
                heartsBg.innerHTML = "";
                for (let i = 0; i < 20; i++) {
                    const heart = document.createElement("div");
                    heart.classList.add("floating-heart");
                    heart.textContent = "‚ù§";
                    heart.style.left = Math.random() * 100 + "%";
                    heart.style.fontSize = Math.random() * 20 + 10 + "px";
                    heart.style.color = heartColors[Math.floor(Math.random() * heartColors.length)];
                    heart.style.animationDuration = Math.random() * 9 + 6 + "s";
                    heart.style.animationDelay = Math.random() * 10 + "s";
                    heartsBg.appendChild(heart);
                }
            }
            createHearts();

            function triggerConfetti() {
                var duration = 3 * 1000;
                var animationEnd = Date.now() + duration;
                var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 99999 };
                function randomInRange(min, max) { return Math.random() * (max - min) + min; }
                var interval = setInterval(function () {
                    var timeLeft = animationEnd - Date.now();
                    if (timeLeft <= 0) { return clearInterval(interval); }
                    var particleCount = 50 * (timeLeft / duration);
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                }, 250);
            }

            function goToSuccess() {
                if (catCountdownTimer) clearInterval(catCountdownTimer);
                mainContainer.style.display = "none";
                catContainer.style.display = "none";
                noBtn.style.display = "none";
                successContainer.style.display = "";
                triggerConfetti();
            }

            yesBtn.addEventListener("click", goToSuccess);
            if (catYesBtn) catYesBtn.addEventListener("click", goToSuccess);

            function typeWriter(text) {
                noBtn.textContent = "";
                if (typingTimer) clearTimeout(typingTimer);

                let i = 0;
                function type() {
                    if (i < text.length) {
                        noBtn.textContent += text.charAt(i);
                        i++;
                        typingTimer = setTimeout(type, Math.random() * 30 + 30);
                    }
                }
                type();
            }

            function triggerNoRain() {
                const count = 6;
                for (let i = 0; i < count; i++) {
                    const drop = document.createElement("div");
                    drop.classList.add("rain-emoji");
                    drop.innerText = rainEmojis[Math.floor(Math.random() * rainEmojis.length)];
                    drop.style.left = Math.random() * 100 + "vw";
                    drop.style.animationDuration = Math.random() * 1 + 1.5 + "s";
                    document.body.appendChild(drop);

                    setTimeout(() => {
                        drop.remove();
                    }, 2500);
                }
            }

            function isDesktop() {
                return window.innerWidth >= 601;
            }

            function evadeNoButton(e) {
                if (e.type === "touchstart" && e.cancelable) e.preventDefault();

                const nowMs = Date.now();
                if (nowMs - lastEvadeAtMs < EVADE_COOLDOWN_MS) return;
                lastEvadeAtMs = nowMs;

                noAttempts++;

                const textIndex = Math.min(noAttempts, noTexts.length - 1);
                typeWriter(noTexts[textIndex]);

                triggerNoRain();

                currentYesScale += 0.15;
                yesBtn.style.setProperty('--btn-scale', currentYesScale);

                if (noAttempts > 2) {
                    yesBtn.classList.remove("shake-active");
                    void yesBtn.offsetWidth;
                    yesBtn.classList.add("shake-active");
                }

                moveButtonLogic();

                updateAttemptCounter();

                if (noAttempts >= CAT_TRIGGER_ATTEMPTS) {
                    triggerCatContingency();
                }
            }

            function moveButtonLogic() {
                if (!noButtonEvading) {
                    const rect = noBtn.getBoundingClientRect();
                    noBtn.style.position = "fixed";
                    noBtn.style.margin = "0";

                    if (isDesktop()) {
                        document.body.appendChild(noBtn);
                        noBtn.style.left = rect.left + "px";
                        noBtn.style.top = rect.top + "px";
                    } else {
                        noBtn.style.left = rect.left + "px";
                        noBtn.style.top = rect.top + "px";
                    }

                    noBtn.classList.add("no-btn-evading");
                    noButtonEvading = true;
                }

                const viewportW = window.innerWidth;
                const viewportH = window.innerHeight;
                const btnW = noBtn.offsetWidth;
                const btnH = noBtn.offsetHeight;
                const padding = 20;

                const maxLeft = viewportW - btnW - padding;
                const maxTop = viewportH - btnH - padding;

                const newLeft = Math.max(padding, Math.random() * maxLeft);
                const newTop = Math.max(padding, Math.random() * maxTop);

                noBtn.style.left = newLeft + "px";
                noBtn.style.top = newTop + "px";
            }

            function updateAttemptCounter() {
                attemptCounter.textContent = noAttempts > 1 ? `Attempts: ${noAttempts}` : "";
                attemptCounter.classList.add("visible");
            }

            noBtn.addEventListener("mouseenter", evadeNoButton);
            noBtn.addEventListener("touchstart", evadeNoButton, { passive: false });
            noBtn.addEventListener("click", evadeNoButton);

            function triggerCatContingency() {
                mainContainer.style.display = "none";
                noBtn.style.display = "none";
                catContainer.style.display = "";

                if (catYesBtn) {
                    catYesBtn.style.setProperty('--btn-scale', 1.2);
                }

                if (catImage && !catImage.getAttribute("src")) catImage.src = CAT_IMAGE_URL;

                if (catCountdownEl && catCountdownNumberEl) {
                    catCountdownEl.style.display = "";
                    let secLeft = CAT_COUNTDOWN_SECONDS;
                    catCountdownNumberEl.textContent = String(secLeft);

                    if (catCountdownTimer) clearInterval(catCountdownTimer);
                    catCountdownTimer = setInterval(() => {
                        secLeft--;
                        catCountdownNumberEl.textContent = secLeft > 0 ? String(secLeft) : "0";
                        if (secLeft <= 0) {
                            clearInterval(catCountdownTimer);
                            goToSuccess();
                        }
                    }, 1000);
                }
            }
        })();
    </script>
</body>

</html>
